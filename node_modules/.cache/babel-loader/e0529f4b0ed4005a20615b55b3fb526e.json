{"ast":null,"code":"import _objectSpread from \"/Users/anthonypafundi/Desktop/baseapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport { orderBookSideLimit } from '../../../api';\nimport { handleIncrementalUpdate, handleIncrementalUpdateArray, sliceArray } from '../../../helpers';\nimport { DEPTH_DATA, DEPTH_DATA_INCREMENT, DEPTH_DATA_SNAPSHOT, DEPTH_ERROR, DEPTH_FETCH, DEPTH_INCREMENT_SUBSCRIBE, ORDER_BOOK_DATA, ORDER_BOOK_ERROR, ORDER_BOOK_FETCH } from './constants';\n// TODO: Move market depth to his own module\nexport var initialOrderBook = {\n  asks: [],\n  bids: [],\n  loading: false\n};\nexport var initialDepth = {\n  asks: [],\n  bids: [],\n  loading: false\n};\nexport var initialIncrementDepth = {\n  marketId: undefined,\n  asks: [],\n  bids: [],\n  sequence: null,\n  loading: false\n};\nexport var orderBookReducer = function orderBookReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialOrderBook;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case ORDER_BOOK_FETCH:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        loading: true,\n        error: undefined\n      });\n\n    case ORDER_BOOK_DATA:\n      var _action$payload = action.payload,\n          asks = _action$payload.asks,\n          bids = _action$payload.bids;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        asks: sliceArray(asks, orderBookSideLimit()),\n        bids: sliceArray(bids, orderBookSideLimit()),\n        loading: false,\n        error: undefined\n      });\n\n    case ORDER_BOOK_ERROR:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        loading: false,\n        error: action.error\n      });\n\n    default:\n      return state;\n  }\n};\nexport var depthReducer = function depthReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialDepth;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case DEPTH_FETCH:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        loading: true,\n        error: undefined,\n        timestamp: Math.floor(Date.now() / 1000)\n      });\n\n    case DEPTH_DATA:\n      var _action$payload2 = action.payload,\n          asks = _action$payload2.asks,\n          bids = _action$payload2.bids;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        asks: sliceArray(asks, orderBookSideLimit()),\n        bids: sliceArray(bids, orderBookSideLimit()),\n        loading: false,\n        error: undefined\n      });\n\n    case DEPTH_ERROR:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        loading: false,\n        error: action.error\n      });\n\n    default:\n      return state;\n  }\n};\nexport var incrementDepthReducer = function incrementDepthReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialIncrementDepth;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case DEPTH_INCREMENT_SUBSCRIBE:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        marketId: action.payload,\n        loading: state.marketId === undefined || state.marketId !== action.payload,\n        timestamp: Math.floor(Date.now() / 1000)\n      });\n\n    case DEPTH_DATA_INCREMENT:\n      var payload = _objectSpread(_objectSpread({}, state), {}, {\n        sequence: action.payload.sequence\n      });\n\n      if (action.payload.asks) {\n        payload.asks = Array.isArray(action.payload.asks[0]) ? handleIncrementalUpdateArray(state.asks, action.payload.asks, 'asks').slice(0, orderBookSideLimit()) : handleIncrementalUpdate(state.asks, action.payload.asks, 'asks').slice(0, orderBookSideLimit());\n      }\n\n      if (action.payload.bids) {\n        payload.bids = Array.isArray(action.payload.bids[0]) ? handleIncrementalUpdateArray(state.bids, action.payload.bids, 'bids').slice(0, orderBookSideLimit()) : handleIncrementalUpdate(state.bids, action.payload.bids, 'bids').slice(0, orderBookSideLimit());\n      }\n\n      return payload;\n\n    case DEPTH_DATA_SNAPSHOT:\n      var _action$payload3 = action.payload,\n          asks = _action$payload3.asks,\n          bids = _action$payload3.bids,\n          sequence = _action$payload3.sequence;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        asks: sliceArray(asks, orderBookSideLimit()),\n        bids: sliceArray(bids, orderBookSideLimit()),\n        sequence,\n        loading: false\n      });\n\n    default:\n      return state;\n  }\n};","map":{"version":3,"sources":["/Users/anthonypafundi/Desktop/baseapp/src/modules/public/orderBook/reducer.ts"],"names":["orderBookSideLimit","handleIncrementalUpdate","handleIncrementalUpdateArray","sliceArray","DEPTH_DATA","DEPTH_DATA_INCREMENT","DEPTH_DATA_SNAPSHOT","DEPTH_ERROR","DEPTH_FETCH","DEPTH_INCREMENT_SUBSCRIBE","ORDER_BOOK_DATA","ORDER_BOOK_ERROR","ORDER_BOOK_FETCH","initialOrderBook","asks","bids","loading","initialDepth","initialIncrementDepth","marketId","undefined","sequence","orderBookReducer","state","action","type","error","payload","depthReducer","timestamp","Math","floor","Date","now","incrementDepthReducer","Array","isArray","slice"],"mappings":"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","sourcesContent":["import { orderBookSideLimit } from '../../../api';\nimport { handleIncrementalUpdate, handleIncrementalUpdateArray, sliceArray } from '../../../helpers';\nimport { DepthActions, OrderBookActions } from './actions';\nimport {\n    DEPTH_DATA,\n    DEPTH_DATA_INCREMENT,\n    DEPTH_DATA_SNAPSHOT,\n    DEPTH_ERROR,\n    DEPTH_FETCH,\n    DEPTH_INCREMENT_SUBSCRIBE,\n    ORDER_BOOK_DATA,\n    ORDER_BOOK_ERROR,\n    ORDER_BOOK_FETCH,\n} from './constants';\nimport {\n    DepthIncrementState,\n    DepthState,\n    OrderBookState,\n} from './types';\n\n// TODO: Move market depth to his own module\n\nexport const initialOrderBook: OrderBookState = {\n    asks: [],\n    bids: [],\n    loading: false,\n};\n\nexport const initialDepth: DepthState = {\n    asks: [],\n    bids: [],\n    loading: false,\n};\n\nexport const initialIncrementDepth: DepthIncrementState = {\n    marketId: undefined,\n    asks: [],\n    bids: [],\n    sequence: null,\n    loading: false,\n};\n\nexport const orderBookReducer = (state = initialOrderBook, action: OrderBookActions): OrderBookState => {\n    switch (action.type) {\n        case ORDER_BOOK_FETCH:\n            return {\n                ...state,\n                loading: true,\n                error: undefined,\n            };\n        case ORDER_BOOK_DATA:\n            const { asks, bids } = action.payload;\n\n            return {\n                ...state,\n                asks: sliceArray(asks, orderBookSideLimit()),\n                bids: sliceArray(bids, orderBookSideLimit()),\n                loading: false,\n                error: undefined,\n            };\n        case ORDER_BOOK_ERROR:\n            return {\n                ...state,\n                loading: false,\n                error: action.error,\n            };\n        default:\n            return state;\n    }\n};\n\nexport const depthReducer = (state = initialDepth, action: DepthActions): DepthState => {\n    switch (action.type) {\n        case DEPTH_FETCH:\n            return {\n                ...state,\n                loading: true,\n                error: undefined,\n                timestamp: Math.floor(Date.now() / 1000),\n            };\n        case DEPTH_DATA:\n            const { asks, bids } = action.payload;\n\n            return {\n                ...state,\n                asks: sliceArray(asks, orderBookSideLimit()),\n                bids: sliceArray(bids, orderBookSideLimit()),\n                loading: false,\n                error: undefined,\n            };\n        case DEPTH_ERROR:\n            return {\n                ...state,\n                loading: false,\n                error: action.error,\n            };\n        default:\n            return state;\n    }\n};\n\nexport const incrementDepthReducer = (state = initialIncrementDepth, action: DepthActions): DepthIncrementState => {\n    switch (action.type) {\n        case DEPTH_INCREMENT_SUBSCRIBE:\n            return {\n                ...state,\n                marketId: action.payload,\n                loading: state.marketId === undefined || state.marketId !== action.payload,\n                timestamp: Math.floor(Date.now() / 1000),\n            };\n        case DEPTH_DATA_INCREMENT:\n            const payload = {\n                ...state,\n                sequence: action.payload.sequence,\n            };\n\n            if (action.payload.asks) {\n                payload.asks = Array.isArray(action.payload.asks[0]) ? (\n                    handleIncrementalUpdateArray(state.asks, action.payload.asks as string[][], 'asks').slice(0, orderBookSideLimit())\n                ) : (\n                    handleIncrementalUpdate(state.asks, action.payload.asks as string[], 'asks').slice(0, orderBookSideLimit())\n                );\n            }\n\n            if (action.payload.bids) {\n                payload.bids = Array.isArray(action.payload.bids[0]) ? (\n                    handleIncrementalUpdateArray(state.bids, action.payload.bids as string[][], 'bids').slice(0, orderBookSideLimit())\n                ) : (\n                    handleIncrementalUpdate(state.bids, action.payload.bids as string[], 'bids').slice(0, orderBookSideLimit())\n                );\n            }\n\n            return payload;\n        case DEPTH_DATA_SNAPSHOT:\n            const { asks, bids, sequence } = action.payload;\n\n            return {\n                ...state,\n                asks: sliceArray(asks, orderBookSideLimit()),\n                bids: sliceArray(bids, orderBookSideLimit()),\n                sequence,\n                loading: false,\n            };\n        default:\n            return state;\n    }\n};\n"]},"metadata":{},"sourceType":"module"}