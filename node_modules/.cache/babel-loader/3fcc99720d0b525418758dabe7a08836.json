{"ast":null,"code":"import _classCallCheck from \"/Users/anthonypafundi/Desktop/baseapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/anthonypafundi/Desktop/baseapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/anthonypafundi/Desktop/baseapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/anthonypafundi/Desktop/baseapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/anthonypafundi/Desktop/baseapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"/Users/anthonypafundi/Desktop/baseapp/src/screens/ProfileTwoFactorAuthScreen/index.tsx\";\nimport * as React from 'react';\nimport { Button } from 'react-bootstrap';\nimport { injectIntl } from 'react-intl';\nimport { connect } from 'react-redux';\nimport { withRouter } from 'react-router-dom';\nimport { compose } from 'redux';\nimport { CloseIcon } from '../../assets/images/CloseIcon';\nimport { CopyableTextField, CustomInput } from '../../components';\nimport { copy, setDocumentTitle } from '../../helpers';\nimport { alertPush, selectMobileDeviceState } from '../../modules';\nimport { generate2faQRFetch, selectTwoFactorAuthBarcode, selectTwoFactorAuthQR, selectTwoFactorAuthSuccess, toggle2faFetch } from '../../modules/user/profile';\n\nvar ToggleTwoFactorAuthComponent = /*#__PURE__*/function (_React$Component) {\n  _inherits(ToggleTwoFactorAuthComponent, _React$Component);\n\n  var _super = _createSuper(ToggleTwoFactorAuthComponent);\n\n  function ToggleTwoFactorAuthComponent() {\n    var _this;\n\n    _classCallCheck(this, ToggleTwoFactorAuthComponent);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      otpCode: ''\n    };\n\n    _this.translate = function (e) {\n      return _this.props.intl.formatMessage({\n        id: e\n      });\n    };\n\n    _this.doCopy = function () {\n      copy('referral-id');\n\n      _this.props.fetchSuccess({\n        message: ['page.body.wallets.tabs.deposit.ccy.message.success'],\n        type: 'success'\n      });\n    };\n\n    _this.renderToggle2fa = function (enable2fa) {\n      var _this$props = _this.props,\n          barcode = _this$props.barcode,\n          qrUrl = _this$props.qrUrl;\n      var otpCode = _this.state.otpCode;\n      var secretRegex = /secret=(\\w+)/;\n      var secretMatch = qrUrl.match(secretRegex);\n      var secret = secretMatch ? secretMatch[1] : null;\n      var submitHandler = enable2fa ? _this.handleEnable2fa : _this.handleDisable2fa;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"container mt-5 pg-profile-two-factor-auth__form p-0\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row m-0 pg-profile-two-factor-auth__header\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-11 col-lg-7 offset-lg-4 mt-0 p-0 pl-3\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 21\n        }\n      }, _this.translate('page.body.profile.header.account.content.twoFactorAuthentication.header')), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-1 mx-0 p-0 px-1\",\n        onClick: _this.goBack,\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(CloseIcon, {\n        className: \"close-icon\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row m-0 pg-profile-two-factor-auth__body\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-12 col-lg-8 col-md-9 pr-0 pl-2 pg-profile-two-factor-auth__body--text d-inline-block\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row col-12 pg-profile-two-factor-auth__body--text--group\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-inline\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"cr-item-number\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 33\n        }\n      }, \"1   \"), /*#__PURE__*/React.createElement(\"span\", {\n        className: \"cr-item-text\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 33\n        }\n      }, _this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.1')), /*#__PURE__*/React.createElement(\"a\", {\n        target: \"_blank\",\n        rel: \"noopener noreferrer\",\n        href: \"https://itunes.apple.com/ru/app/google-authenticator/id388497605?mt=8\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 33\n        }\n      }, \"AppStore \"), /*#__PURE__*/React.createElement(\"span\", {\n        className: \"cr-item-text\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 33\n        }\n      }, _this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.or')), /*#__PURE__*/React.createElement(\"a\", {\n        target: \"_blank\",\n        rel: \"noopener noreferrer\",\n        href: \"https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 33\n        }\n      }, \"Google play\"))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row col-12 pg-profile-two-factor-auth__body--text--group\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-inline\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"cr-item-number\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 33\n        }\n      }, \"2    \"), /*#__PURE__*/React.createElement(\"span\", {\n        className: \"cr-item-text\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 33\n        }\n      }, _this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.2')), /*#__PURE__*/React.createElement(\"br\", {\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 33\n        }\n      }), /*#__PURE__*/React.createElement(\"span\", {\n        className: \"cr-item-text\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 33\n        }\n      }, _this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.3'))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-12 col-lg-4 col-md-3 pt-4 pg-profile-two-factor-auth__body--barcode\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 21\n        }\n      }, enable2fa && _this.renderTwoFactorAuthQR(barcode))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row m-0 p-5 pg-profile-two-factor-auth__copyablefield\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 17\n        }\n      }, enable2fa && secret && _this.renderSecret(secret)), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row m-0 pg-profile-two-factor-auth__body\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-12 pl-2 pg-profile-two-factor-auth__body--text d-inline-block\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row col-12 pg-profile-two-factor-auth__body--text--group\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-12 col-md-8 col-sm-7\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"cr-item-number\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 33\n        }\n      }, \"3   \"), /*#__PURE__*/React.createElement(\"span\", {\n        className: \"cr-item-text\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 33\n        }\n      }, _this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.4'))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-12 col-md-4 col-sm-5\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"fieldset\", {\n        className: \"pg-profile-two-factor-auth__body--input\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(CustomInput, {\n        handleChangeInput: _this.handleOtpCodeChange,\n        type: \"tel\",\n        inputValue: otpCode,\n        placeholder: _this.translate('page.body.profile.header.account.content.twoFactorAuthentication.subHeader'),\n        onKeyPress: _this.handleEnterPress,\n        label: _this.translate('page.body.profile.header.account.content.twoFactorAuthentication.subHeader'),\n        defaultLabel: \"\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 37\n        }\n      })))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row p-5\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-12 m-0\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        onClick: submitHandler,\n        size: \"lg\",\n        variant: \"primary\",\n        type: \"button\",\n        block: true,\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 25\n        }\n      }, _this.translate('page.body.profile.header.account.content.twoFactorAuthentication.enable')))));\n    };\n\n    _this.renderTwoFactorAuthQR = function (barcode) {\n      var src = \"data:image/png;base64,\".concat(barcode);\n      return barcode.length > 0 && /*#__PURE__*/React.createElement(\"img\", {\n        alt: \"\",\n        className: \"pg-profile-two-factor-auth__qr\",\n        src: src,\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 38\n        }\n      });\n    };\n\n    _this.renderSecret = function (secret) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"pg-profile-two-factor-auth__copyablefield__container\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"legend\", {\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 17\n        }\n      }, _this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.mfa')), /*#__PURE__*/React.createElement(\"fieldset\", {\n        onClick: _this.doCopy,\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 17\n        }\n      }, secret && /*#__PURE__*/React.createElement(CopyableTextField, {\n        value: secret,\n        fieldId: \"secret-2fa\",\n        label: \"\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 32\n        }\n      })));\n    };\n\n    _this.handleOtpCodeChange = function (value) {\n      _this.setState({\n        otpCode: value\n      });\n    };\n\n    _this.handleEnterPress = function (event) {\n      var enable2fa = _this.get2faAction();\n\n      var submitHandler = enable2fa ? _this.handleEnable2fa : _this.handleDisable2fa;\n\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        submitHandler();\n      }\n    };\n\n    _this.handleEnable2fa = function () {\n      _this.props.toggle2fa({\n        code: _this.state.otpCode,\n        enable: true\n      });\n    };\n\n    _this.handleDisable2fa = function () {\n      _this.props.toggle2fa({\n        code: _this.state.otpCode,\n        enable: false\n      });\n    };\n\n    _this.handleNavigateToProfile = function () {\n      _this.props.history.push('/profile');\n    };\n\n    _this.get2faAction = function () {\n      var routingState = _this.props.history.location.state;\n      return routingState ? routingState.enable2fa : false;\n    };\n\n    _this.goBack = function () {\n      window.history.back();\n    };\n\n    return _this;\n  }\n\n  _createClass(ToggleTwoFactorAuthComponent, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      setDocumentTitle('Two factor authentication');\n      var enable2fa = this.get2faAction();\n\n      if (enable2fa) {\n        this.props.generateQR();\n      }\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(next) {\n      if (!this.props.success && next.success) {\n        this.handleNavigateToProfile();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var enable2fa = this.get2faAction();\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"pg-profile-two-factor-auth\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 13\n        }\n      }, this.renderToggle2fa(enable2fa));\n    }\n  }]);\n\n  return ToggleTwoFactorAuthComponent;\n}(React.Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    qrUrl: selectTwoFactorAuthQR(state),\n    barcode: selectTwoFactorAuthBarcode(state),\n    success: selectTwoFactorAuthSuccess(state),\n    isMobileDevice: selectMobileDeviceState(state)\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    generateQR: function generateQR() {\n      return dispatch(generate2faQRFetch());\n    },\n    toggle2fa: function toggle2fa(_ref) {\n      var code = _ref.code,\n          enable = _ref.enable;\n      return dispatch(toggle2faFetch({\n        code,\n        enable\n      }));\n    },\n    fetchSuccess: function fetchSuccess(payload) {\n      return dispatch(alertPush(payload));\n    }\n  };\n};\n\nexport var ProfileTwoFactorAuthScreen = compose(injectIntl, withRouter, connect(mapStateToProps, mapDispatchToProps))(ToggleTwoFactorAuthComponent);","map":{"version":3,"sources":["/Users/anthonypafundi/Desktop/baseapp/src/screens/ProfileTwoFactorAuthScreen/index.tsx"],"names":["React","Button","injectIntl","connect","withRouter","compose","CloseIcon","CopyableTextField","CustomInput","copy","setDocumentTitle","alertPush","selectMobileDeviceState","generate2faQRFetch","selectTwoFactorAuthBarcode","selectTwoFactorAuthQR","selectTwoFactorAuthSuccess","toggle2faFetch","ToggleTwoFactorAuthComponent","state","otpCode","translate","e","props","intl","formatMessage","id","doCopy","fetchSuccess","message","type","renderToggle2fa","enable2fa","barcode","qrUrl","secretRegex","secretMatch","match","secret","submitHandler","handleEnable2fa","handleDisable2fa","goBack","renderTwoFactorAuthQR","renderSecret","handleOtpCodeChange","handleEnterPress","src","length","value","setState","event","get2faAction","key","preventDefault","toggle2fa","code","enable","handleNavigateToProfile","history","push","routingState","location","window","back","generateQR","next","success","Component","mapStateToProps","isMobileDevice","mapDispatchToProps","dispatch","payload","ProfileTwoFactorAuthScreen"],"mappings":"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","sourcesContent":["import { History } from 'history';\nimport * as React from 'react';\nimport { Button } from 'react-bootstrap';\nimport { injectIntl } from 'react-intl';\nimport { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { withRouter } from 'react-router-dom';\nimport { compose } from 'redux';\nimport { IntlProps } from '../../';\nimport { CloseIcon } from '../../assets/images/CloseIcon';\nimport { CopyableTextField, CustomInput } from '../../components';\nimport { copy, setDocumentTitle } from '../../helpers';\nimport { alertPush, RootState, selectMobileDeviceState } from '../../modules';\nimport {\n    generate2faQRFetch,\n    selectTwoFactorAuthBarcode,\n    selectTwoFactorAuthQR,\n    selectTwoFactorAuthSuccess,\n    toggle2faFetch,\n} from '../../modules/user/profile';\n\ninterface RouterProps {\n    history: History;\n}\n\ninterface ReduxProps {\n    barcode: string;\n    qrUrl: string;\n    success?: boolean;\n    isMobileDevice: boolean;\n}\n\ninterface DispatchProps {\n    toggle2fa: typeof toggle2faFetch;\n    generateQR: typeof generate2faQRFetch;\n    fetchSuccess: typeof alertPush;\n}\n\ntype Props = RouterProps & ReduxProps & DispatchProps & IntlProps;\n\ninterface State {\n    otpCode: string;\n}\n\nclass ToggleTwoFactorAuthComponent extends React.Component<Props, State> {\n    public state = {\n        otpCode: '',\n    };\n\n    public componentDidMount() {\n        setDocumentTitle('Two factor authentication');\n        const enable2fa = this.get2faAction();\n        if (enable2fa) {\n            this.props.generateQR();\n        }\n    }\n\n    public componentWillReceiveProps(next: Props) {\n        if (!this.props.success && next.success) {\n            this.handleNavigateToProfile();\n        }\n    }\n\n    public translate = (e: string) => {\n        return this.props.intl.formatMessage({ id: e });\n    };\n\n    public doCopy = () => {\n        copy('referral-id');\n        this.props.fetchSuccess({message: ['page.body.wallets.tabs.deposit.ccy.message.success'], type: 'success'});\n    };\n\n    public render() {\n        const enable2fa = this.get2faAction();\n\n        return (\n            <div className=\"pg-profile-two-factor-auth\">\n                {this.renderToggle2fa(enable2fa)}\n            </div>\n        );\n    }\n\n    private renderToggle2fa = (enable2fa: boolean) => {\n        const {\n            barcode,\n            qrUrl,\n        } = this.props;\n        const { otpCode } = this.state;\n\n        const secretRegex = /secret=(\\w+)/;\n        const secretMatch = qrUrl.match(secretRegex);\n        const secret = secretMatch ? secretMatch[1] : null;\n        const submitHandler = enable2fa ? this.handleEnable2fa : this.handleDisable2fa;\n\n        return (\n            <div className=\"container mt-5 pg-profile-two-factor-auth__form p-0\">\n                <div className=\"row m-0 pg-profile-two-factor-auth__header\">\n                    <div className=\"col-11 col-lg-7 offset-lg-4 mt-0 p-0 pl-3\">\n                        {this.translate('page.body.profile.header.account.content.twoFactorAuthentication.header')}\n                    </div>\n                    <div className=\"col-1 mx-0 p-0 px-1\" onClick={this.goBack}>\n                        <CloseIcon className=\"close-icon\" />\n                    </div>\n                </div>\n\n                <div className=\"row m-0 pg-profile-two-factor-auth__body\">\n                    <div className=\"col-12 col-lg-8 col-md-9 pr-0 pl-2 pg-profile-two-factor-auth__body--text d-inline-block\">\n                        <div className=\"row col-12 pg-profile-two-factor-auth__body--text--group\">\n                            <div className=\"d-inline\">\n                                <span className=\"cr-item-number\">1   </span>\n                                <span className=\"cr-item-text\">{this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.1')}</span>\n                                <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://itunes.apple.com/ru/app/google-authenticator/id388497605?mt=8\">AppStore </a>\n                                <span className=\"cr-item-text\">{this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.or')}</span>\n                                <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl\">Google play</a>\n                            </div>\n                        </div>\n                        <div className=\"row col-12 pg-profile-two-factor-auth__body--text--group\">\n                            <div className=\"d-inline\">\n                                <span className=\"cr-item-number\">2    </span>\n                                <span className=\"cr-item-text\">{this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.2')}</span>\n                                <br />\n                                <span className=\"cr-item-text\">{this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.3')}</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"col-12 col-lg-4 col-md-3 pt-4 pg-profile-two-factor-auth__body--barcode\">\n                        {enable2fa && this.renderTwoFactorAuthQR(barcode)}\n                    </div>\n                </div>\n                <div className=\"row m-0 p-5 pg-profile-two-factor-auth__copyablefield\">\n                    {enable2fa && secret && this.renderSecret(secret)}\n                </div>\n                <div className=\"row m-0 pg-profile-two-factor-auth__body\">\n                    <div className=\"col-12 pl-2 pg-profile-two-factor-auth__body--text d-inline-block\">\n                        <div className=\"row col-12 pg-profile-two-factor-auth__body--text--group\">\n                            <div className=\"col-12 col-md-8 col-sm-7\">\n                                <span className=\"cr-item-number\">3   </span>\n                                <span className=\"cr-item-text\">{this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.4')}</span>\n                            </div>\n                            <div className=\"col-12 col-md-4 col-sm-5\">\n                                <fieldset className=\"pg-profile-two-factor-auth__body--input\">\n                                    <CustomInput\n                                        handleChangeInput={this.handleOtpCodeChange}\n                                        type=\"tel\"\n                                        inputValue={otpCode}\n                                        placeholder={this.translate('page.body.profile.header.account.content.twoFactorAuthentication.subHeader')}\n                                        onKeyPress={this.handleEnterPress}\n                                        label={this.translate('page.body.profile.header.account.content.twoFactorAuthentication.subHeader')}\n                                        defaultLabel=\"\"\n                                    />\n                                </fieldset>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"row p-5\">\n                    <div className=\"col-12 m-0\">\n                        <Button\n                            onClick={submitHandler}\n                            size=\"lg\"\n                            variant=\"primary\"\n                            type=\"button\"\n                            block={true}\n                        >\n                            {this.translate('page.body.profile.header.account.content.twoFactorAuthentication.enable')}\n                        </Button>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    private renderTwoFactorAuthQR = (barcode: string) => {\n        const src = `data:image/png;base64,${barcode}`;\n\n        return barcode.length > 0 && <img alt=\"\" className=\"pg-profile-two-factor-auth__qr\" src={src} />;\n    };\n\n    private renderSecret = (secret: string) => {\n        return (\n            <div className=\"pg-profile-two-factor-auth__copyablefield__container\">\n                <legend>{this.translate('page.body.profile.header.account.content.twoFactorAuthentication.message.mfa')}</legend>\n                <fieldset onClick={this.doCopy}>\n                    {secret && <CopyableTextField\n                      value={secret}\n                      fieldId=\"secret-2fa\"\n                      label=\"\"\n                    />\n                    }\n                </fieldset>\n            </div>\n        );\n    };\n\n    private handleOtpCodeChange = (value: string) => {\n        this.setState({\n            otpCode: value,\n        });\n    };\n\n    private handleEnterPress = (event: React.KeyboardEvent<HTMLInputElement>) => {\n        const enable2fa = this.get2faAction();\n        const submitHandler = enable2fa ? this.handleEnable2fa : this.handleDisable2fa;\n        if (event.key === 'Enter') {\n            event.preventDefault();\n            submitHandler();\n        }\n    };\n\n    private handleEnable2fa = () => {\n        this.props.toggle2fa({\n            code: this.state.otpCode,\n            enable: true,\n        });\n    };\n\n    private handleDisable2fa = () => {\n        this.props.toggle2fa({\n            code: this.state.otpCode,\n            enable: false,\n        });\n    };\n\n    private handleNavigateToProfile = () => {\n        this.props.history.push('/profile');\n    };\n\n    private get2faAction = () => {\n        const routingState = this.props.history.location.state as any;\n\n        return routingState ? routingState.enable2fa : false;\n    };\n\n    private goBack = () => {\n        window.history.back();\n    };\n}\n\nconst mapStateToProps: MapStateToProps<ReduxProps, Props, RootState> = state => ({\n    qrUrl: selectTwoFactorAuthQR(state),\n    barcode: selectTwoFactorAuthBarcode(state),\n    success: selectTwoFactorAuthSuccess(state),\n    isMobileDevice: selectMobileDeviceState(state),\n});\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, {}> = dispatch => ({\n    generateQR: () => dispatch(generate2faQRFetch()),\n    toggle2fa: ({ code, enable }) => dispatch(toggle2faFetch({ code, enable })),\n    fetchSuccess: payload => dispatch(alertPush(payload)),\n});\n\nexport const ProfileTwoFactorAuthScreen = compose(\n    injectIntl,\n    withRouter,\n    connect(mapStateToProps, mapDispatchToProps),\n)(ToggleTwoFactorAuthComponent) as React.ComponentClass;\n"]},"metadata":{},"sourceType":"module"}